{% extends "game/base.html" %}

{% block content %}
<div class="auth-container animate__animated animate__fadeIn">
    <div class="auth-card">
        <h2 class="text-center mb-4"><i class="fas fa-envelope me-2"></i>邮箱验证</h2>
        
        {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        
        <form method="post" class="auth-form">
            {% csrf_token %}
            
            <div class="mb-3">
                <label for="email" class="form-label">电子邮箱</label>
                <input type="email" class="form-control" id="email" name="email" required>
            </div>
            
            <div class="mb-3">
                <label for="code" class="form-label">验证码</label>
                <input type="text" class="form-control" id="code" name="code" required>
                <div class="form-text">请输入发送到您邮箱的6位验证码</div>
            </div>
            
            <button type="submit" class="btn btn-pink w-100 mb-3">
                <i class="fas fa-check-circle me-2"></i>验证邮箱
            </button>
            
            <div class="text-center">
                <small>没有收到验证码？<a href="#" id="resendCode">重新发送</a></small>
            </div>
        </form>
    </div>
</div>

{% block scripts %}
<script>
document.getElementById('resendCode').addEventListener('click', function(e) {
    e.preventDefault();
    const email = document.getElementById('email').value;
    if (!email) {
        alert('请输入邮箱地址');
        return;
    }
    
    fetch('/resend_verification/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: `email=${encodeURIComponent(email)}`
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('验证码已重新发送');
        } else {
            alert(data.error || '发送失败');
        }
    });
});
</script>
{% endblock %}
{% endblock %}